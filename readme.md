# プログラミング試験

## 実行

```
$ pytohn q1.py
```

他の設問の回答についても同様

## 実行結果

### 1

```
=== 10.10.10.3/24 ===
2022-01-01 00:00:10 - 2022-01-01 00:00:20 (0:00:10)
2022-01-01 00:01:50 - 2022-01-01 00:02:50 (0:01:00)
=== 10.10.10.1/24 ===
2022-01-01 00:00:10 - 2022-01-01 00:00:30 (0:00:20)
2022-01-01 00:03:00 - - (-)
=== 10.10.10.2/24 ===
2022-01-01 00:00:20 - 2022-01-01 00:00:40 (0:00:20)
2022-01-01 00:02:10 - 2022-01-01 00:02:30 (0:00:20)
=== 20.20.20.1/24 ===
2022-01-01 00:01:00 - 2022-01-01 00:02:20 (0:01:20)
=== 20.20.20.2/24 ===
2022-01-01 00:01:10 - 2022-01-01 00:02:20 (0:01:10)
=== 20.20.20.3/24 ===
2022-01-01 00:00:50 - 2022-01-01 00:02:20 (0:01:30)
=== 30.30.0.1/16 ===
2022-01-01 00:02:50 - - (-)
=== 30.30.0.2/16 ===
2022-01-01 00:02:50 - - (-)
=== 30.30.0.3/16 ===
2022-01-01 00:02:50 - - (-)
```

- `=== ip address ===` がサーバのIPアドレス
- その後の行について
  - `障害発生日時 - 障害解消日時 (障害期間)` のフォーマットになっている
  - ログ終了時点では障害が解消していない場合障害解消日時と障害期間を `-` としている

### 2 (N=2)

```
=== 10.10.10.1/24 ===
2022-01-01 00:00:10 - 2022-01-01 00:00:30 (0:00:20)
2022-01-01 00:03:00 - - (-)
=== 10.10.10.2/24 ===
2022-01-01 00:00:20 - 2022-01-01 00:00:40 (0:00:20)
2022-01-01 00:02:10 - 2022-01-01 00:02:30 (0:00:20)
=== 20.20.20.1/24 ===
2022-01-01 00:01:00 - 2022-01-01 00:02:20 (0:01:20)
=== 20.20.20.2/24 ===
2022-01-01 00:01:10 - 2022-01-01 00:02:20 (0:01:10)
=== 20.20.20.3/24 ===
2022-01-01 00:00:50 - 2022-01-01 00:02:20 (0:01:30)
=== 10.10.10.3/24 ===
2022-01-01 00:01:50 - 2022-01-01 00:02:50 (0:01:00)
=== 30.30.0.1/16 ===
2022-01-01 00:02:50 - - (-)
=== 30.30.0.2/16 ===
2022-01-01 00:02:50 - - (-)
=== 30.30.0.3/16 ===
2022-01-01 00:02:50 - - (-)
```

形式についてはq1と同様

### 3 (N=2 m=2 t=5)

```
=== 10.10.10.1/24 ===
  --- 故障期間 ---
  2022-01-01 00:00:10 - 2022-01-01 00:00:30 (0:00:20)
  2022-01-01 00:03:00 - - (-)
  --- 過不可状態期間 ---
  2022-01-01 00:01:50 - 2022-01-01 00:02:50 (0:01:00)
=== 20.20.20.3/24 ===
  --- 故障期間 ---
  2022-01-01 00:00:50 - 2022-01-01 00:02:20 (0:01:30)
  --- 過不可状態期間 ---
=== 30.30.0.2/16 ===
  --- 故障期間 ---
  2022-01-01 00:02:50 - - (-)
  --- 過不可状態期間 ---
=== 30.30.0.1/16 ===
  --- 故障期間 ---
  2022-01-01 00:02:50 - - (-)
  --- 過不可状態期間 ---
=== 20.20.20.1/24 ===
  --- 故障期間 ---
  2022-01-01 00:01:00 - 2022-01-01 00:02:20 (0:01:20)
  --- 過不可状態期間 ---
=== 10.10.10.2/24 ===
  --- 故障期間 ---
  2022-01-01 00:00:20 - 2022-01-01 00:00:40 (0:00:20)
  2022-01-01 00:02:10 - 2022-01-01 00:02:30 (0:00:20)
  --- 過不可状態期間 ---
  2022-01-01 00:01:50 - 2022-01-01 00:02:50 (0:01:00)
  2022-01-01 00:03:00 - - (-)
=== 10.10.10.3/24 ===
  --- 故障期間 ---
  2022-01-01 00:01:50 - 2022-01-01 00:02:50 (0:01:00)
  --- 過不可状態期間 ---
=== 30.30.0.3/16 ===
  --- 故障期間 ---
  2022-01-01 00:02:50 - - (-)
  --- 過不可状態期間 ---
=== 20.20.20.2/24 ===
  --- 故障期間 ---
  2022-01-01 00:01:10 - 2022-01-01 00:02:20 (0:01:10)
  --- 過不可状態期間 ---
  2022-01-01 00:02:20 - 2022-01-01 00:02:40 (0:00:20)
```

ほぼq1,q2と同様の形式で、故障期間と過不可状態の期間をそれぞれ出力している

### 4 (N=2 m=2 t=5)

```
# サーバ障害
=== 20.20.20.2/24 ===
  --- 故障期間 ---
  2022-01-01 00:01:10 - 2022-01-01 00:02:20 (0:01:10)
  --- 過不可状態期間 ---
  2022-01-01 00:02:20 - 2022-01-01 00:02:40 (0:00:20)
=== 30.30.0.3/16 ===
  --- 故障期間 ---
  2022-01-01 00:02:50 - - (-)
  --- 過不可状態期間 ---
=== 10.10.10.2/24 ===
  --- 故障期間 ---
  2022-01-01 00:00:20 - 2022-01-01 00:00:40 (0:00:20)
  2022-01-01 00:02:10 - 2022-01-01 00:02:30 (0:00:20)
  --- 過不可状態期間 ---
  2022-01-01 00:01:50 - 2022-01-01 00:02:50 (0:01:00)
  2022-01-01 00:03:00 - - (-)
=== 30.30.0.2/16 ===
  --- 故障期間 ---
  2022-01-01 00:02:50 - - (-)
  --- 過不可状態期間 ---
=== 30.30.0.1/16 ===
  --- 故障期間 ---
  2022-01-01 00:02:50 - - (-)
  --- 過不可状態期間 ---
=== 10.10.10.1/24 ===
  --- 故障期間 ---
  2022-01-01 00:00:10 - 2022-01-01 00:00:30 (0:00:20)
  2022-01-01 00:03:00 - - (-)
  --- 過不可状態期間 ---
  2022-01-01 00:01:50 - 2022-01-01 00:02:50 (0:01:00)
=== 20.20.20.3/24 ===
  --- 故障期間 ---
  2022-01-01 00:00:50 - 2022-01-01 00:02:20 (0:01:30)
  --- 過不可状態期間 ---
=== 20.20.20.1/24 ===
  --- 故障期間 ---
  2022-01-01 00:01:00 - 2022-01-01 00:02:20 (0:01:20)
  --- 過不可状態期間 ---
=== 10.10.10.3/24 ===
  --- 故障期間 ---
  2022-01-01 00:01:50 - 2022-01-01 00:02:50 (0:01:00)
  --- 過不可状態期間 ---

# ネットワーク障害
=== 20.20.20.0/24 ===
  2022-01-01 00:01:10 - 2022-01-01 00:02:20 (0:01:10)
=== 10.10.10.0/24 ===
=== 30.30.0.0/16 ===
  2022-01-01 00:02:50 - - (-)
```

サーバ障害についてはq3と同様
ネットワーク障害についてはq1と同様の形式で出力している

## 説明

### 1

メインでは

- ファイル (log.txt) を読み込み、
- ログを内部で使いやすい形式に変換し
- チェック処理

をしている

ログの変換はジェネレータとして行ごとにdatetime,str,Optional[int]の形でそれぞれ名前をつけたデータクラスに変換している

チェックについては

- 障害発生中辞書 (Dict[IPアドレス, ログ])
- 解消した障害リスト (List[ログ])
- を保持し、
- ping値がNoneの時、
  - そのIPが辞書になければ障害発生
  - すでにあれば障害継続中
- ping値がNoneでない時、
  - そのIPが辞書にあれば障害解消
  - なければ正常
- として集計している
- このときにつかわれているサーバリスト(IPアドレスリスト)を作成しておく
- 出力部分では
  - 発生中の辞書と障害が解消したリストをあわせて
  - ipアドレスごとにグループ化し、
  - それぞれ日時と期間を出力する
- として出力している

### 2

- ログ型にping値がNoneの回数をカウントするフィールドを追加した
- 集計中にping値がNoneですでに辞書にあった場合カウントを1増やす
- 障害解消のタイミングでカウントがN以上のときだけ障害解消リストに入れ、N未満は破棄する

ように変更した

### 3

- 故障期間と別に過不可状態期間を集計する辞書とリストを作成した
- 故障と同じように、ping値がtより大きい時に過不可状態として集計した
- 出力もそれぞれ別に出力している

のように変更した

### 4

ネットワーク障害の検出について

- ネットワークごとに
  - サーバごとの障害期間を抽出
  - ネットワーク内のすべてのサーバの障害期間でかぶっている部分を抽出
  - その期間をネットワーク障害期間とする

として集計した

出力も他の設問と同じようにネットワークのIPアドレスごとに障害の期間を出力している

## ログ

サーバを

- 10.10.10.1/24
- 10.10.10.2/24
- 10.10.10.3/24
- 20.20.20.1/24
- 20.20.20.2/24
- 20.20.20.3/24
- 30.30.0.1/16
- 30.30.0.2/16
- 30.30.0.3/16

の9つとして10秒ごとにpingしている

makelog.py 内で障害と過不可の有無を時間ごとに設定している
